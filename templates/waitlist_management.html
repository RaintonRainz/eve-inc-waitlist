{% extends "base.html" %}

{% block title %}WL Management{% endblock %}

{% block head %}
{{ super() }}
<script type="text/javascript">
function removeEntry(entryId, userId) {
	$.post("{{url_for('fittings.api_wl_remove_entry')}}", {'entryId': entryId, '_csrf_token': '{{ csrf_token() }}'}, function(){
		var entry_id = "entry-{{queue.name}}-"+userId
		var entry = document.getElementById(entry_id);
		if (entry != null) { // there is a entry for him on that wl
			entry.parentNode.removeChild(entry); // remote it from the DOM
		}
	}, "text");
}

function moveEntryToWaitlists(entryId, userId) {
	$.post("{{url_for('fittings.move_to_waitlists')}}", {'entryId': entryId, '_csrf_token': '{{ csrf_token() }}'}, function(){
		var entry_id = "entry-{{queue.name}}-"+userId
		var entry = document.getElementById(entry_id);
		if (entry != null) { // there is a entry for him on that wl
			entry.parentNode.removeChild(entry); // remote it from the DOM
		}
	}, "text")
}
</script>
<script src="https://quiescens.duckdns.org/wl/wtm.js"></script>
{% endblock %}

{% block data %}
<div class="col-sm-4" id="wl-{{ queue.name }}">
	<ol class="list-group">
		<li class="list-group-item text-capitalize">{{ queue.name|e }} WL</li>
		{% for entry in queue.entries %}
		<li class="list-group-item" id="entry-{{ queue.name }}-{{ entry.user }}">
			<div class="card">
				<div class="container">
					<a href="javascript:CCPEVE.showInfo(1377, {{ entry.user }})">
					<div class="row">
						<div class="col-sm-2 hidden-sm-down">
							<img src="https://image.eveonline.com/Character/{{ entry.user }}_32.jpg" alt="{{ entry.user_data.eve_name|e }}">
						</div>
						<div class="col-sm-8">
						{{ entry.user_data.eve_name|e }}
						</div>
					</div>
					</a>
					<div class="row">
						<div class="btn-group btn-group-mini" role="group" aria-label="Action Buttons">
							<!-- <button type="button" class="btn btn-primary" onclick="javascript:CCPEVE.showInfo(1377, {{ entry.user }})">Char</button> -->
							<button type="button" class="btn btn btn-danger" onclick="javascript:removeEntry({{ entry.id }}, {{ entry.user }})">Remove</button>
							<button type="button" class="btn btn btn-secondary" onclick="javascript:CCPEVE.startConversation({{ entry.user }})">Convo</button>
							<button type="button" class="btn btn btn-success" onclick="javascript:moveEntryToWaitlists({{ entry.id }}, {{ entry.user }})">Approve</button>
						</div>
					</div>
				</div>
  				<ul class="list-group list-group-flush">
				{% for fit in entry.fittings %}
    				<li class="list-group-item">
    					<div class="container fit-link btn btn-info" data-dna="{{ fit.ship_type }}:{{ fit.modules }}">
    					<div class="row">
    						<div class="col-sm-4 hidden-sm-down">
    						<img src="https://image.eveonline.com/Render/{{ fit.ship_type }}_32.png" alt="{{ entry.user_data.eve_name|e }}">
    						</div>
    						<div class="col-sm-8">
    							<div class="row">
    							{{ fit.ship.typeName|e }}
    							</div>
    							{% if fit.comment is not none %}
    							<div class="row">
    							<small>{{ fit.comment|safe }}</small>
    							</div>
    							{% endif %}
    						</div>
    					</div>
    					</div>
    				</li>
				{% endfor %}
  				</ul>
			</div>
		</li>
		{% endfor %}
	</ol>
</div>
{% endblock %}
